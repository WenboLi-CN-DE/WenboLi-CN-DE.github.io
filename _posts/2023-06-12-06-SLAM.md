---
layout: post
title: æ±½è½¦è§†è§‰ Automotive Vision - SLAM
tag: [ä¸“ä¸š, æ±½è½¦è§†è§‰]
mathjax: true
---

<head>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
</head>

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    packages: ['base', 'newcommand', 'configMacros']
  },
  svg: {
    fontCache: 'global'
  }
};
</script>

<script> 
MathJax = {
  tex: {
    inlineMath: [['$', '$']],
    processEscapes: true
  }
};
</script>

# Chapter 6: Self-Localization and Mapping

**References**
- Sebastian Thrun, Wolfram Burgard, Dieter Fox, Probabilistic Robotics. MIT Press,
2005, Chapter 7-13 (partly)
- Hugh Durrant-Whyte, Tim Bailey, Simultaneous Localization and Mapping: Part I,
IEEE Robotics and Automation Magazine, 13(2), pg. 99-110, 2006
- Tim Bailey, Hugh Durrant-Whyte, Simultaneous Localization and Mapping: Part II,
IEEE Robotics and Automation Magazine, 13(3), pg. 108-117, 2006
- Bruno Siciliano, Khatib Oussama (Hrsg.), Springer Handbook of Robotics, Springer,
2008, Chapter 37
- Joachim Hertzberg, Kai Lingemann, Andreas NÃ¼chter, Mobile Roboter â€“ Eine
EinfÃ¼hrung aus Sicht der Informatik, Springer 2012, Chapters 5+6
- Ingemar J. Cox, Blanche â€“ an Experiment in Guidance and Navigation of an
Autonomous Robot Vehicle. IEEE Transactions on Robots and Automation, 7(2),
pg. 193-204, 1991

**Self Localization è‡ªå®šä½**

self localization problem è‡ªå®šä½é—®é¢˜ï¼š

- environment is known (map) ç¯å¢ƒæ˜¯å·²çŸ¥çš„
- vehicle position and orientation are unkonown è½¦è¾†ä½ç½®å’Œæ–¹å‘æœªçŸ¥
- vehicle observes the (local) environment è½¦è¾†è§‚å¯Ÿï¼ˆæœ¬åœ°ï¼‰ç¯å¢ƒ

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612161042.png)

## Localization with landmarks åœ°æ ‡å®šä½

### landmarks åœ°æ ‡ï¼š
 
consistently identifiable points in the world. E.g. lighthouses, feature points in imaging

ä¸€ç›´å¯ä»¥è¢«è¯†åˆ«çš„ç‚¹ï¼Œä¾‹å¦‚ç¯å¡”ã€å›¾åƒä¸­çš„ç‰¹å¾ç‚¹

 #### what can we conclude from... 2dï¼šæˆ‘ä»¬å¯ä»¥ä»...ä¸­å¾—å‡ºä»€ä¹ˆç»“è®º ?
 - the distance to a given landmark?åˆ°ä¸€ä¸ªç»™å®šåœ°æ ‡çš„è·ç¦»ï¼Ÿ 
   - robot position on a circle 
   - unknown orientatioin
 - the distance between two landmarks?åˆ°ä¸¤ä¸ªç»™å®šåœ°æ ‡çš„è·ç¦»ï¼Ÿ
   - 2 possible positons
   - unknown orientation
 - the distance between three landmarks?åˆ°ä¸‰ä¸ªç»™å®šåœ°æ ‡çš„è·ç¦»ï¼Ÿ
   - robot position(some exceptions are possible)æœºå™¨äººä½ç½®ï¼ˆå¯èƒ½æœ‰ä¸€äº›ä¾‹å¤–ï¼‰
   - orientationo unknown

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612162130.png)


- the angle, from which a landmark is being observed åœ°æ ‡çš„è§’åº¦å·²ç»è¢«è§‚æµ‹åˆ°
  - positon unknown 
  - relation between *position* and *orientation*

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612162831.png)
- the angle from which two landmarks are being observed? ä¸¤ä¸ªåœ°æ ‡ä¹‹é—´çš„è§’åº¦å·²ç»è¢«è§‚æµ‹åˆ°
  - robot position on an arc or line segment åœ†å¼§æˆ–çº¿æ®µä¸Šçš„æœºå™¨äººä½ç½®
  - relation between *position* and *orientation*
  - approch: inscribed angle theorem

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612162950.png)

#### linear landmarks çº¿æ€§åœ°æ ‡
   -  ä¾‹å¦‚ï¼š roadway lines, curbs, and walls é“è·¯çº¿ã€è·¯ç¼˜å’Œå¢™å£
  
![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612163335.png)

#### what can we conclude from... ï¼šæˆ‘ä»¬å¯ä»¥ä»...ä¸­å¾—å‡ºä»€ä¹ˆç»“è®º ?

- the orthogonal distance,in which a line is being observed è§‚æµ‹ä¸€æ¡çº¿çš„å‚ç›´è·ç¦»
  - position on two parallel lines ä¸¤æ¡å¹³è¡Œçº¿
  - relation between position and orientation
- the orthogonal distance to two lines ä¸¤æ¡çº¿çš„å‚ç›´è·ç¦»
  -  4 points / 2 points
  -  relation between position and orientation 

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612164044.png)


### One-Shot Localization ä¸€æ¬¡æ€§å®šä½ç®—æ³•

> "One-Shot Localization" æ˜¯æŒ‡åœ¨**ä»…æœ‰ä¸€æ¬¡è§‚æµ‹**æˆ–ä¿¡æ¯çš„æƒ…å†µä¸‹è¿›è¡Œå®šä½æˆ–ä½ç½®ä¼°è®¡çš„è¿‡ç¨‹ã€‚å®ƒæ˜¯æŒ‡é€šè¿‡**ä¸€æ¬¡è§‚æµ‹æˆ–ä¸€æ¬¡è¾“å…¥**ï¼Œä»æœªçŸ¥ä½ç½®æˆ–ç¯å¢ƒä¸­å‡†ç¡®åœ°ç¡®å®šç›®æ ‡çš„ä½ç½®æˆ–å§¿æ€ã€‚åœ¨ä¼ æ„Ÿå™¨æŠ€æœ¯å’Œæœºå™¨äººé¢†åŸŸä¸­ï¼Œè¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨äºæè¿°ä½¿ç”¨å•ä¸ªæ•°æ®æ ·æœ¬è¿›è¡Œ**ä½ç½®ä¼°è®¡**çš„æ–¹æ³•æˆ–ç®—æ³•ã€‚è¿™ç§æ–¹æ³•å¯èƒ½åˆ©ç”¨ä¼ æ„Ÿå™¨æ•°æ®ã€å›¾åƒå¤„ç†æŠ€æœ¯æˆ–å…¶ä»–ä¿¡æ¯æºæ¥å®ç°ç›®æ ‡çš„å®šä½ã€‚ä¸ä¼ ç»Ÿçš„è¿­ä»£å®šä½ç®—æ³•ç›¸æ¯”ï¼ŒOne-Shot Localization ç€é‡äºé€šè¿‡å•æ¬¡è§‚æµ‹å°½å¯èƒ½å‡†ç¡®åœ°ç¡®å®šç›®æ ‡çš„ä½ç½®ï¼Œä»è€Œå‡å°‘è®¡ç®—å’Œæ—¶é—´æˆæœ¬ã€‚


ç»™å®šï¼š 
- a map with a set of landmarks
- a set of boserved landmarks from seen from a vehicle

ä»»åŠ¡ï¼š
- how do I have to shift and rotate the vehicle so that the observed landmarks match best the land marks in the map?
- æˆ‘å¦‚ä½•ç§»åŠ¨å’Œæ—‹è½¬è½¦è¾†ï¼Œä»¥ä¾¿è§‚å¯Ÿåˆ°çš„åœ°æ ‡ä¸åœ°å›¾ä¸­çš„åœ°æ ‡æœ€åŒ¹é…ï¼Ÿ
  
![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612165012.png)

æ•°å­¦æ–¹æ³•ï¼šmathematically

- which movement (translation + rotation) transforms *vehicle coordinates* into *world coordinates* such that observed **landmark positions fit to map position**?
- å“ªç§è¿åŠ¨ï¼ˆå¹³ç§»+æ—‹è½¬ï¼‰å°†*è½¦è¾†åæ ‡*è½¬æ¢ä¸º*ä¸–ç•Œåæ ‡*ï¼Œä»¥ä¾¿è§‚å¯Ÿåˆ°çš„**åœ°æ ‡ä½ç½®é€‚é…åˆ°åœ°å›¾ä½ç½®**ï¼Ÿ
  
![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612165001.png)

- landmark positions in world coordinates (map) ä¸–ç•Œåæ ‡ä¸­çš„åœ°æ ‡ä½ç½®ï¼ˆåœ°å›¾ï¼‰ï¼š

$$\vec{p_{1}},\cdots,\vec{p_{i}},...$$

- observed landmark positions in vehicle coordinates åœ¨è½¦è¾†åæ ‡ä¸­è§‚å¯Ÿåˆ°çš„åœ°æ ‡ä½ç½®:

$$\vec{q}_{1},\cdot\cdot\cdot,\vec{q}_{i},\cdot\cdot\cdot,\vec{q}_{N}$$

- optimization problem:
  
![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612182552.png)

- æœ€å°åŒ–ä¸‹é¢çš„å¼å­ï¼šminimize

$$E(R,\bar{t})=\frac{1}{N}\sum_{i=1}^{N}||\vec{p_{i}}-(R\vec{q_{i}}+\vec{t})||^{2}$$

withï¼š

$$
\begin{aligned}
& E(R, \vec{t})=\frac{1}{N} \sum_{i=1}^N\left\|\vec{p}_i^{\prime}+\bar{p}-\left(R\left(\vec{q}_i^{\prime}+\bar{q}\right)+\vec{t}\right)\right\|^2 \\
& =\frac{1}{N} \sum_{i=1}^N\left\|\left(\vec{p}_i^{\prime}-R \vec{q}_i^{\prime}\right)+(\bar{p}-R \bar{q}-\vec{t})\right\|^2 \\
& =\frac{1}{N} \sum_{i=1}^N\left\|\vec{p}_i^{\prime}-R \vec{q}_i^{\prime}\right\|^2+\|\bar{p}-R \bar{q}-\vec{t}\|^2+\frac{2}{N} \sum_{i=1}^N(\bar{p}-R \bar{q}-\vec{t})^T\left(\vec{p}_i^{\prime}-R \vec{q}_i^{\prime}\right) \\
& =\frac{1}{N} \sum_{i=1}^N\left\|\vec{p}_i^{\prime}-R \vec{q}_i^{\prime}\right\|^2+\|\bar{p}-R \bar{q}-\vec{t}\|^2+2(\bar{p}-R \bar{q}-\vec{t})^T\left(\frac{1}{N} \sum_{i=1}^N \vec{p}_i^{\prime}-R \frac{1}{N} \sum_{i=1}^N \vec{q}_i^{\prime}\right) \\
& =\frac{1}{N} \sum_{i=1}^N\left\|\vec{p}_i^{\prime}-R \vec{q}_i^{\prime}\right\|^2+\underbrace{\|\bar{p}-R \bar{q}-\vec{t}\|^2} \\
& =0 \quad \underbrace{N}_{=0} \\
& \Rightarrow \vec{t}=\bar{p}-R \bar{q} \\
& =\left\|\vec{p}_i^{\prime}\right\|^2+\left\|\vec{q}_i^{\prime}\right\|^2-2\left(\vec{p}_i^{\prime}\right)^T R \vec{q}_i^{\prime} \\
&
\end{aligned}
$$

æœ€å¤§åŒ–ï¼š 

$\sum_{i=1}^N\left(\vec{p}_i^{\prime}\right)^T R \vec{q}_i^{\prime}$

- ä¸åŒçš„æ–¹æ³•ï¼Œä¾‹å¦‚ SVDï¼š

$$\sum_{i=1}^{N}\left(\vec{p}_{i}^{\prime}\right)^{T} R \vec{q}_{i}^{\prime}=\sum_{i=1}^{N} \operatorname{Tr}\left(R \vec{q}_{i}^{\prime}\left(\vec{p}_{i}^{\prime}\right)^{T}\right)=\operatorname{Tr}(R H) \quad \text { with } H=\sum_{i=1}^{N} \vec{q}_{i}^{\prime}\left(\vec{p}_{i}^{\prime}\right)^{T}$$

- mathematical theorem (singular value decomposition, SVD):
for every real matrix H exist orthogonal matrices U,V, and a diagonal matrix D with nonnegative entries, such that:
æ•°å­¦å®šç†ï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼ŒSVDï¼‰ï¼šå¯¹äºæ¯ä¸ªå®æ•°çŸ©é˜µ Hï¼Œå­˜åœ¨æ­£äº¤çŸ©é˜µ Uã€V å’Œå…·æœ‰éè´Ÿé¡¹çš„å¯¹è§’çŸ©é˜µ Dï¼Œä½¿å¾—ï¼š$H=U D V^{T}$

- solutionï¼š

![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612190302.png)

$$(Derivation and proof: K.S.Arun, T.S.Hunang, S.D.Blostein, Least Squares Fitting of Two 3-D Point Sets,
IEEE Transactions on Pattern Analysis and Machine Intelligence 9(5), 1987)$$

- what to do if landmarks are not uniquely identifiable?å¦‚æœåœ°æ ‡ä¸æ˜¯å”¯ä¸€å¯è¯†åˆ«çš„æ€ä¹ˆåŠï¼Ÿ
  - $\vec{q_{i}}\ \mathrm{\bf~might~rester~to~any~of}\ \ \vec{p_{1}},\ ...,\vec{p_{i}},...$
- brute force solution: try all possible combinations è›®åŠ›è§£å†³æ–¹æ¡ˆï¼šå°è¯•æ‰€æœ‰å¯èƒ½çš„ç»„åˆ
  - computationally too expensive è®¡ç®—æˆæœ¬å¤ªé«˜
  
- iterative, greedy assignments: è¿­ä»£ï¼Œè´ªå©ªçš„åˆ†é…ï¼š
  - $\text { assign } \vec{q}_i \text { to closest landmark among } \vec{p}_1, \ldots, \vec{p}_i, \ldots$
  -  reassign all observations incrementally é€æ­¥é‡æ–°åˆ†é…æ‰€æœ‰è§‚å¯Ÿç»“æœ
  -  ğŸ‘‰ ICP algorithm è¿­ä»£æœ€è¿‘ç®—æ³•


#### ICP algorithm ä¸‰ç»´ç‚¹äº‘é…å‡†

>ICPï¼ˆIterative Closest Pointï¼‰ç®—æ³•æ˜¯ä¸€ç§è¿­ä»£çš„ç‚¹äº‘é…å‡†ç®—æ³•ï¼Œç”¨äºå°†ä¸¤ä¸ªæˆ–å¤šä¸ªç‚¹äº‘ä¹‹é—´è¿›è¡Œå¯¹é½å’ŒåŒ¹é…ã€‚å®ƒæ˜¯ä¸€ç§å¸¸ç”¨çš„ä¸‰ç»´ç‚¹äº‘é…å‡†ç®—æ³•ï¼Œåœ¨è®¡ç®—æœºè§†è§‰ã€æœºå™¨äººå’Œåœ°å›¾æ„å»ºç­‰é¢†åŸŸå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚
>
>ICPç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡è¿­ä»£çš„æ–¹å¼ï¼Œå°†å¾…é…å‡†çš„ç›®æ ‡ç‚¹äº‘ä¸å‚è€ƒç‚¹äº‘å¯¹é½ï¼Œä½¿å®ƒä»¬åœ¨ç©ºé—´ä¸­å°½å¯èƒ½é‡åˆã€‚ç®—æ³•çš„æ ¸å¿ƒæ˜¯æ‰¾åˆ°ä¸¤ä¸ªç‚¹äº‘ä¹‹é—´çš„æœ€ä½³åˆšæ€§å˜æ¢ï¼ˆæ—‹è½¬å’Œå¹³ç§»ï¼‰ï¼Œä½¿å¾—å®ƒä»¬çš„é‡å éƒ¨åˆ†æœ€å¤§åŒ–ã€‚

  
![](https://raw.githubusercontent.com/WenboLi-CN-DE/Picture/main/20230612192547.png)

- Iterative Closest Point (ICP)(Besl, McKay 1992)
  - calculates rotation $R$ and translation $\overrightarrow{t}$ in order to transform a set of points $Q$ onto another set of points $P$ è®¡ç®—æ—‹è½¬çŸ©é˜µ $R$ å’Œå¹³ç§»å‘é‡ $\overrightarrow{t}$ï¼Œä»¥å°†ç‚¹é›† $Q$ å˜æ¢åˆ°å¦ä¸€ä¸ªç‚¹é›† $P$
  -  ICP always terminates ICPæ€»æ˜¯ç»ˆæ­¢
  -  ICP converges to local minimum of <br> æ”¶æ•›åˆ°å±€éƒ¨æœ€å°å€¼
  
 $$ E(R,\vec{t})\longrightarrow\frac{1}{N}\sum_{i=1}^{N}\,||\vec{p}_{j}(i)-\left(R\vec{q}_{i}+\vec{t}\right)||^{2}$$
 


- ç®€è¦è¯æ˜
  - by construction, $E(R,\overrightarrow{t})$ is minimized in step 8 assuming fixed assignments between points æ ¹æ®ç»“æ„ï¼Œåœ¨æ­¥éª¤8ä¸­ï¼Œ$E(R,\overrightarrow{t})$æ˜¯æœ€å°åŒ–çš„ï¼Œå‡è®¾ç‚¹ä¹‹é—´æœ‰å›ºå®šçš„åˆ†é…ã€‚
  -  by construction, $E(R,\overrightarrow{t})$ is minimized in step 4 assuming fixed translation and rotation æ ¹æ®ç»“æ„ï¼Œåœ¨æ­¥éª¤4ä¸­ï¼Œå‡è®¾å›ºå®šçš„å¹³ç§»å’Œæ—‹è½¬ï¼Œ$E(R,\overrightarrow{t})$è¢«æœ€å°åŒ–äº†
  -  hence, $E(R,\overrightarrow{t})$ never increases
  -  since number of possible assignments is finite, we cannot generate new
permutations in step 4 from a certain point on (pigeonhole/Dirichlet principle) ç”±äºå¯èƒ½çš„åˆ†é…æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ç¬¬ 4 æ­¥ä¸­ä»æŸä¸ªç‚¹ç”Ÿæˆæ–°çš„æ’åˆ—ï¼ˆpigeonhole/Dirichlet principleï¼‰







## Incremental Localization å¢é‡æœ¬åœ°åŒ–

## Mapping æ˜ å°„

## Simultaneous Localization and Mapping(SLAM)
